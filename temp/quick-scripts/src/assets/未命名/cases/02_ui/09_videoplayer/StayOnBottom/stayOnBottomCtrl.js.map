{"version":3,"sources":["assets/未命名 上午10.54.12/cases/02_ui/09_videoplayer/StayOnBottom/stayOnBottomCtrl.js"],"names":["cc","macro","ENABLE_TRANSPARENT_CANVAS","randomNum","min","max","Math","random","TIPS","Class","Component","properties","tempBarrage","Prefab","videoPlayer","VideoPlayer","barrageRoot","Node","tips","start","__id","_animList","node","find","btnPlay","getComponent","Button","interactable","btnPause","btnStop","onCreateBarrage","instantiate","___id","y","parent","r","g","b","color","label","Label","idx","floor","length","string","animComp","Animation","on","destroy","onClearBarrages","_intervalID","clearInterval","keys","Object","i","len","key","anim","onOpenBarrages","setInterval","onPlayAnim","onCloseBarrages","onPauseAnim","getAnimationState","isPaused","resume","play","pause","active","stop"],"mappings":"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","sourceRoot":"/","sourcesContent":["// 开启 Canvas 背景支持 alpha 通道\ncc.macro.ENABLE_TRANSPARENT_CANVAS = true;\n\nfunction randomNum (min, max){\n    return Math.random() * (max - min + 1) + min;\n}\n\nconst TIPS = [\n    '这个是一个范例，该范例是让用户知道如何把 UI 渲染到 VideoPlayer 上',\n    'UI 渲染到 VideoPlayer 上只需三个步骤：1。创建代码开启 cc.macro.ENABLE_TRANSPARENT_CANVAS 2。设置摄像机的背景颜色的透明度为零 3。勾选 VideoPlayer 组件上的 stayOnBottom 属性 -- 就 OK 了',\n    'UI 居然可以显示在 VidePlayer 上面了，👍👍👍👍👍',\n    '哇，可以做弹幕功能了... 💐💐💐💐💐',\n    '哇，可以做约会游戏了... 💐💐💐💐💐',\n    '注意：该功能只支持 web 平台',\n    '注意：该功能的效果在各个浏览器的限制下不能保持效果一致',\n    '我是打酱油的...',\n    'Cococs Creator 是最棒的，不接收反驳...',\n    '前面的说的对...',\n    '其实我也不知道要说什么，反正只是为了充数用而已'\n];\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tempBarrage: cc.Prefab,\n        videoPlayer: cc.VideoPlayer,\n        barrageRoot: cc.Node,\n        tips: cc.Node,\n    },\n\n    start () {\n        this.__id = 0;\n        this._animList = [];\n\n        let node = cc.find('Canvas/Play');\n        this.btnPlay = node.getComponent(cc.Button);\n        this.btnPlay.interactable = true;\n\n        node = cc.find('Canvas/Pause');\n        this.btnPause = node.getComponent(cc.Button);\n        this.btnPause.interactable = false;\n\n        node = cc.find('Canvas/Stop');\n        this.btnStop = node.getComponent(cc.Button);\n        this.btnStop.interactable = false;\n    },\n\n    // 创建弹幕\n    onCreateBarrage () {\n        let node = cc.instantiate(this.tempBarrage);\n        ++this.__id;\n        node.___id = this.__id;\n        node.y = randomNum(300, -120);\n        node.parent = this.node;\n        let r = randomNum(0, 255);\n        let g = randomNum(0, 255);\n        let b = randomNum(0, 255);\n        node.color = cc.color(r, g, b);\n        let label = node.getComponent(cc.Label);\n        let idx = Math.floor(randomNum(0, TIPS.length - 1));\n        label.string = TIPS[idx];\n        let animComp = node.getComponent(cc.Animation);\n        animComp.on('stop', () => {\n            delete this._animList[node.___id];\n            node.destroy();\n        });\n        this._animList[this.__id] = animComp;\n    },\n\n    // 清空弹幕\n    onClearBarrages () {\n        this._intervalID && clearInterval(this._intervalID);\n        let keys = Object.keys(this._animList);\n        for (let i = 0, len = keys.length; i < len; ++i) {\n            let key = keys[i];\n            let anim = this._animList[key];\n            anim.node.destroy();\n        }\n        this._animList.length = 0;\n    },\n\n    // 开启弹幕\n    onOpenBarrages () {\n        this._intervalID = setInterval(() => {\n            this.onCreateBarrage();\n        }, 1000);\n        this.onPlayAnim();\n    },\n\n    // 关闭弹幕\n    onCloseBarrages () {\n        this._intervalID && clearInterval(this._intervalID);\n        this.onPauseAnim();\n    },\n\n    // 播放弹幕动画\n    onPlayAnim () {\n        let keys = Object.keys(this._animList);\n        for (let i = 0, len = keys.length; i < len; ++i) {\n            let key = keys[i];\n            let anim = this._animList[key];\n            if (anim.getAnimationState('barrage-animClip').isPaused) {\n                anim.resume();\n            }\n            else {\n                anim.play();\n            }\n        }\n    },\n\n    // 暂停弹幕动画\n    onPauseAnim () {\n        for (let key in this._animList) {\n            let anim = this._animList[key];\n            anim.pause();\n        }\n    },\n\n    // 播放视频\n    play () {\n        this.tips.active = false;\n        this.btnPlay.interactable = false;\n        this.btnPause.interactable = true;\n        this.btnStop.interactable = true;\n        this.videoPlayer.play();\n        this.onOpenBarrages();\n    },\n\n    // 暂停视频\n    pause () {\n        this.btnPlay.interactable = true;\n        this.btnPause.interactable = false;\n        this.btnStop.interactable = true;\n        this.videoPlayer.pause();\n        this.onCloseBarrages();\n    },\n\n    // 停止视频\n    stop () {\n        this.tips.active = true;\n        this.btnPlay.interactable = true;\n        this.btnPause.interactable = false;\n        this.btnStop.interactable = false;\n        this.videoPlayer.stop();\n        this.onClearBarrages();\n    },\n});\n"]}