{"version":3,"sources":["assets/Script/LevelSelect.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport { Constants } from \"./Config/Constants\";\nimport Game from \"./Game\";\nimport LevelBase from \"./LevelBase\";\nimport SelectUI from \"./UI/SelectUI\";\nimport { UIManager, UIType } from \"./UIManager\";\nimport { Utils } from \"./Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class LevelSelect extends LevelBase {\n  @property(cc.SpriteFrame)\n  listBgSpf: cc.SpriteFrame[] = [];\n  @property(cc.Sprite)\n  bgSp: cc.Sprite = null;\n  @property(cc.Label)\n  titleLabel: cc.Label = null;\n  @property(cc.Node)\n  titleNode: cc.Node = null;\n  @property(cc.Node)\n  listOption: cc.Node[] = [];\n  @property(cc.SpriteFrame)\n  listOptionSpf: cc.SpriteFrame[] = [];\n  @property(cc.Node)\n  overPanel: cc.Node = null;\n  @property(cc.Node)\n  allOverPanel: cc.Node = null;\n  @property(cc.Node)\n  bubble: cc.Node = null;\n  @property(cc.Node)\n  playerList: cc.Node[] = [];\n  @property(cc.Label)\n  bubbleLabel: cc.Label = null;\n  @property(cc.Label)\n  btnLabel: cc.Label = null;\n  @property(cc.Node)\n  topStarNode: cc.Node = null;\n\n  private _topicId = 0;\n  private _topicData = null;\n  private _optionBtnList: cc.Button[] = [];\n  private _lastPlayerId: number = -1;\n  private _haveWrong: boolean = false;\n  private _starList: cc.Node[] = [];\n  public get starList() {\n    return this._starList;\n  }\n\n  onLoad() {\n    cc.director.on(\"gameNextLevel\", this._newLevel, this);\n  }\n\n  init(playerId?: number) {\n    this._topicId = 0;\n    this._topicData = null;\n    this._lastPlayerId = playerId;\n    this.overPanel.active = false;\n    this.allOverPanel.active = false;\n    this._loadTopic();\n  }\n\n  _loadTopic() {\n    this._topicData = Constants.getConfigById(this._lastPlayerId)[this._topicId];\n    this.titleLabel.string = this._topicData.title;\n    this.listOption.forEach((option, i) => {\n      this.listOption[i].active = i == this._topicData.optionId;\n    });\n    this._optionBtnList = this.listOption[this._topicData.optionId].getComponentsInChildren(cc.Button);\n    this._optionBtnList.forEach((btn, i) => {\n      btn.node.getComponent(cc.Sprite).spriteFrame = this.listOptionSpf[0];\n      // btn.node.getChildByName(\"label\").getComponent(cc.Label).string = this._topicData.options[i];\n    });\n\n    this.bgSp.spriteFrame = this.listBgSpf[this._topicData.bgId];\n    this.bgSp.node.opacity = 0;\n    cc.tween(this.bgSp.node)\n      .to(0.5, { opacity: 255 })\n      .start();\n\n    this.titleNode.y = 756;\n    cc.tween(this.titleNode)\n      .to(1, { y: 472 }, { easing: \"elasticInOut\" })\n      .start();\n\n    this._haveWrong = false;\n  }\n\n  _loadNextTopic() {\n    if (this._topicId === Constants.getConfigLength(this._lastPlayerId) - 1) {\n      if (Game.instance.lastSelectPlayerIdList.length === 1) {\n        this._topicId = 0;\n        this.overPanel.active = true;\n        this.bubble.scaleX = this._lastPlayerId == 0 ? 1 : -1;\n        const otherPlayerData = Constants.getPlayerById(this._getOtherPlayerId());\n        this.bubbleLabel.string = Utils.stringFormat(Constants.allGameString.str0, otherPlayerData.name);\n        this.btnLabel.string = Utils.stringFormat(Constants.allGameString.str1, otherPlayerData.name);\n        this.playerList.forEach((player, index) => {\n          player.active = index == this._lastPlayerId;\n        });\n      } else if (Game.instance.lastSelectPlayerIdList.length === 2) {\n        this.allOverPanel.active = true;\n        this.scheduleOnce(() => {\n          UIManager.instance.showUI(UIType.ResultUI);\n        }, 1.5);\n      }\n      return;\n    }\n    this._topicId++;\n    this._loadTopic();\n  }\n\n  _getOtherPlayerId() {\n    return this._lastPlayerId == 0 ? 1 : 0;\n  }\n\n  onClickEvent(event, parm) {\n    if (parm == \"nextPlayer\") {\n      UIManager.instance.showUI(UIType.SelectUI, (baseLevel: SelectUI) => {\n        baseLevel.showConetentByIndex(this._getOtherPlayerId());\n      });\n      return;\n    }\n\n    for (let i = 0; i < this._optionBtnList.length; i++) {\n      const name = this._optionBtnList[i].node.name;\n      // 节点名称btn_0, btn_1，去最后数字判断点击哪个按钮\n      if (name.substring(name.length - 1) == parm) {\n        let sp = this._optionBtnList[i].node.getComponent(cc.Sprite).spriteFrame;\n        // 按钮变红和灰的逻辑\n        // if (sp.name == this.listOptionSpf[0].name) {\n        //   this._optionBtnList[i].node.getComponent(cc.Sprite).spriteFrame = this.listOptionSpf[1];   // gray\n        // } else {\n        //   this._optionBtnList[i].node.getComponent(cc.Sprite).spriteFrame = this.listOptionSpf[0];   // red\n        // }\n\n        const isCorrect = this._topicData.answers.includes(Number(parm));\n        if (!this._haveWrong) {\n          this._haveWrong = !isCorrect;\n        }\n        this.scheduleOnce(() => {\n          UIManager.instance.showUI(UIType.AnswerUI, null, isCorrect, this._haveWrong);\n        }, 0.3);\n\n        break;\n      }\n    }\n  }\n\n  _newLevel(isShowAni) {\n    isShowAni && this._showStar();\n    this._loadNextTopic();\n  }\n\n  _showStar() {\n    if (this.topStarNode) {\n      const star = cc.instantiate(this.topStarNode);\n      star.parent = this.topStarNode.parent;\n      this._starList.push(star);\n      star.active = true;\n    }\n  }\n\n  reset() {\n    for (let i = this._starList.length - 1; i >= 0; i--) {\n      this._starList[i].destroy();\n      this._starList.splice(i, 1);\n    }\n  }\n}\n"]}